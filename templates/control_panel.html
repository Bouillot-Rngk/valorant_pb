<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BO3 Pick & Ban Control Panel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    @font-face {
      font-family: 'Rajdhani';
      src: url("static/fonts/Rajdhani/Rajdhani-Bold.ttf") format('truetype');
      font-weight: bold;
    }
    @font-face {
      font-family: 'Rajdhani';
      src: url("static/fonts/Rajdhani/Rajdhani-Regular.ttf") format('truetype');
      font-weight: normal;
    }
    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: #222;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    .section {
      margin: 20px auto;
      max-width: 800px;
      background: #333;
      padding: 20px;
      border-radius: 8px;
    }
    input[type="text"] {
      padding: 5px;
      font-size: 1em;
      border-radius: 4px;
      border: none;
      margin: 5px;
    }
    .action-section {
      margin-top: 20px;
    }
    .options {
      margin: 15px 0;
    }
    label {
      margin: 0 10px;
      font-size: 1.2em;
    }
    button {
      padding: 10px 20px;
      font-size: 1.2em;
      background: #8cba11;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #7aa00e;
    }
  </style>
</head>
<body>
  <h1>BO3 Pick & Ban Control Panel</h1>
  <div class="section">
    <h2>Team Information</h2>
    <input type="text" id="teamA" placeholder="Team A Name">
    <input type="text" id="teamB" placeholder="Team B Name">
    <button onclick="updateTeams()">Update Teams</button>
  </div>
  <div class="section action-section">
    <h2 id="instruction">Instruction: </h2>
    <div class="options" id="options"></div>
    <button onclick="submitAction()">Submit Action</button>
  </div>
  <div class="section">
    <button onclick="resetBO()">Reset BO</button>
  </div>
  
  <script>
    function resetBO() {
      socket.emit('reset_state');
    }
  </script>
  
  
  <script>
    const socket = io();
    let currentStep = 0;
    let state = {};
    
    socket.on('state_updated', function(newState) {
      state = newState;
      currentStep = state.step;
      updateInstruction();
    });
    
    function updateTeams() {
      const teamA = document.getElementById('teamA').value;
      const teamB = document.getElementById('teamB').value;
      socket.emit('update_teams', { teamA, teamB });
    }
    
    function updateInstruction() {
      const instr = document.getElementById('instruction');
      const optionsDiv = document.getElementById('options');
      optionsDiv.innerHTML = "";
      let text = "";
      
      // For steps where we combine a pick and side selection, we treat two steps as one action.
      if (currentStep === 0) {
        text = state.teamA + " ban a map:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 1) {
        text = state.teamB + " ban a map:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 2) {
        text = state.teamA + " pick map for Map 1:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 3) {
        text = state.teamB + " pick side for Map 1:";
        createRadioOptions(["attack", "defense"], "side");
      } else if (currentStep === 4) {
        text = state.teamB + " pick map for Map 2:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 5) {
        text = state.teamA + " pick side for Map 2:";
        createRadioOptions(["attack", "defense"], "side");
      } else if (currentStep === 6) {
        text = state.teamA + " ban a map:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 7) {
        text = state.teamB + " pick map for Map 3:";
        createRadioOptions(state.available_maps, "map");
      } else if (currentStep === 8) {
        text = state.teamA + " pick side for Map 3:";
        createRadioOptions(["attack", "defense"], "side");
      } else {
        text = "BO3 process completed.";
        optionsDiv.innerHTML = "";
      }
      instr.innerText = text;
    }
    
    function createRadioOptions(optionsArray, name) {
      const optionsDiv = document.getElementById('options');
      optionsArray.forEach(option => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="${name}" value="${option}"> ${option}`;
        optionsDiv.appendChild(label);
      });
    }
    
    function submitAction() {
      let data = {};
      if ([0, 1, 2, 4, 6, 7].includes(currentStep)) {
        const selected = document.querySelector(`input[name="map"]:checked`);
        data.map = selected ? selected.value : "TBD";
      } else if ([3, 5, 8].includes(currentStep)) {
        const selected = document.querySelector(`input[name="side"]:checked`);
        data.side = selected ? selected.value : "TBD";
      }
      socket.emit('update_action', data);
    }
  </script>
</body>
</html>
